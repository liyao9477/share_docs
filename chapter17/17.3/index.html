<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>17.3 - liyao碎片机</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "17.3";
    var mkdocs_page_input_path = "chapter17/17.3.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> liyao碎片机</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Index</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../git/">Git</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../r/">R</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../linux/">Linux</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../linux_cmd/">Linux_cmd</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../cmd_line/">Cmd_line</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../awe_python/">Awe_python</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../awe_spider/">Awe_spider</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../data_science2/">Data_science</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../machine_learning/">ML</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../ml_tutor/">ML_tutor</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../mysql_chefs/">Mysql_chefs</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../21m_mysql/">Mysql_21m</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../math/">Math</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../statistic_python/">Statistic_python</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../dm_da/">DM_DA</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../sci/">Sci</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../utilities/">Uti</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../web/">Web</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../ajenti/">ajenti</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../macos_app/">Macos_app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../r4ds/">r4ds</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../python_spider/">Python_spider</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../p_books/">P_books</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">liyao碎片机</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>17.3</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="mysql">MySQL修改密码</h1>
<h2 id="mysqld_safe">mysqld_safe不存在修改密码</h2>
<ol>
<li>停止 MySQL:</li>
</ol>
<pre><code class="bash">systemctl stop mysqld
</code></pre>

<ol>
<li>设置MySQL环境选项</li>
</ol>
<pre><code class="bash">systemctl set-environment MYSQLD_OPTS=&quot;--skip-grant-tables&quot;
</code></pre>

<ol>
<li>使用您刚才设置的选项启动MySQL</li>
</ol>
<pre><code class="bash">systemctl start mysqld
</code></pre>

<ol>
<li>以root身份登录</li>
</ol>
<pre><code class="bash">mysql -u root
</code></pre>

<ol>
<li>使用这些MySQL命令更新root用户密码</li>
</ol>
<pre><code class="bash">mysql&gt; UPDATE mysql.user SET authentication_string = PASSWORD('MyNewPassword')
    -&gt; WHERE User = 'root' AND Host = 'localhost';
mysql&gt; FLUSH PRIVILEGES;
mysql&gt; quit
</code></pre>

<ol>
<li>停止mysql</li>
</ol>
<pre><code class="bash">systemctl stop mysqld
</code></pre>

<ol>
<li>取消设置MySQL环境选项，以便下次启动</li>
</ol>
<pre><code class="bash">systemctl unset-environment MYSQLD_OPTS
</code></pre>

<ol>
<li>正常启动MySQL：</li>
</ol>
<pre><code class="bash">systemctl start mysqld
</code></pre>

<ol>
<li>尝试使用您的新密码登录：</li>
</ol>
<pre><code class="bash">mysql -u root -p
</code></pre>

<h2 id="mysqlroot">启动修改丢失的mysql单实例root密码方法</h2>
<ol>
<li>首先停止mysql</li>
</ol>
<pre><code class="bash">sudo /etc/init.d/mysql stop

# 或者下面
sudo /usr/local/mysql/bin/mysql stop

# 或者 
service mysqld stop
</code></pre>

<ol>
<li>使用--skip-grant-tables启动mysql，忽略授权登录验证，服务不要停止，新开窗口做接下来的操作。</li>
</ol>
<pre><code class="bash">sudo mysqld_safe --skip-grant-tables --user=mysql # 提示：在启动时加--skip-grant-tables 参数，表示忽略授权验证
# 或者下面
sudo /usr/local/mysql/bin/mysqld_safe  --skip-grant-tables --user=mysql
</code></pre>

<ol>
<li>进入数据库系统</li>
</ol>
<pre><code class="bash"># 在终端中运行
mysql
</code></pre>

<ol>
<li>修改mysqlroot密码：update</li>
</ol>
<pre><code class="bash"># 终端进入MySQL数据中运行
mysql&gt; update mysql.user set password=password(&quot;123456&quot;) where user='root' and host='localhost';
mysql&gt; flush privileges;

# 终端中运行
mysqladmin -uroot -p123456 shutdown
</code></pre>

<ol>
<li>重新启动mysql</li>
</ol>
<pre><code class="bash"># 终端中运行
/etc/init.d/mysql start
mysql -uroot -p123456
</code></pre>

<h2 id="macmysqlroot">Mac下重置MySQL的root密码</h2>
<p>以前的老版本root的默认密码为空，Mysql 5.6及以后版本出处于安全考虑，root密码已经不为空了。</p>
<pre><code class="bash"># 表示没有生成root的临时密码
ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)

# 表示生成了root的临时密码
ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)
</code></pre>

<p>使用 <code>mysql -uroot -p</code> 登录进去。</p>
<p>1、停止 mysql server</p>
<p>在 Mac 中可以使用GUI停止 MySQL 服务，步骤：<code>系统偏好设置</code> &gt; <code>MySQL</code> &gt; <code>Stop MySQL Server</code>。您也可以使用命令行来停止服务，命令如下：</p>
<pre><code class="bash"># Mac OS 里面可以这种方式
sudo /usr/local/mysql/support-files/mysql.server stop

# centos 停止mysql数据库
sudo /etc/init.d/mysqld stop 
</code></pre>

<p>2、终端，输入进入安全模式，运行之后进程保持挂载。</p>
<pre><code class="bash">sudo /usr/local/mysql/bin/mysqld_safe --skip-grant-tables
</code></pre>

<p>3、新开终端，输入</p>
<pre><code class="bash">sudo /usr/local/mysql/bin/mysql -u root
# 输入 Mac 系统用户密码后，
# 直接敲回车进入 mysql 终端，输入：
mysql&gt; FLUSH PRIVILEGES;
mysql&gt; ALTER USER 'root'@'localhost' IDENTIFIED BY 'MyNewPass';
# 输入 \q 退出 mysql 终端
\q
</code></pre>

<p>4、重启MySQL.</p>
<pre><code class="bash">ps -ef | grep mysql
</code></pre>

<ul>
<li>通过上面命令查看进程编号。  </li>
<li>通过<code>sudo kill 93</code>杀掉<code>mysql</code>进程  </li>
<li>启动服务<code>系统偏好设置</code> &gt; <code>MySQL</code> &gt; <code>Start MySQL Server</code></li>
</ul>
<p>命令行中更快捷的重启  </p>
<pre><code class="bash">sudo /usr/local/mysql/support-files/mysql.server start
</code></pre>

<h2 id="mysqld">不重启mysqld修改密码的方法</h2>
<p>1、首先得有一个可以拥有修改权限的mysql数据库账号，当前的mysql实例账号（较低权限的账号，比如可以修改test数据库）或者其他相同版本实例的账号。把data/mysql目录下面的user表相关的文件复制到data/test目录下面。</p>
<pre><code>[root@localhost mysql]# cp mysql/user.* test/
[root@localhost mysql]# chown mysql.mysql test/user.*
</code></pre>

<p>2、使用另一个较低权限的账号链接数据库，设置test数据库中的user存储的密码数据。</p>
<pre><code>[root@localhost mysql]# mysql -utest -p12345
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 17
Server version: 5.5.25a-log Source distribution

Copyright (c) 2000, 2011, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; use test
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; update user set password=password('yayun') where user='root';
Query OK, 0 rows affected (0.00 sec)
Rows matched: 5  Changed: 0  Warnings: 0

mysql&gt;
</code></pre>

<p>3、把修改后的user.MYD和user.MYI复制到mysql目录下，记得备份之前的文件。</p>
<pre><code class="bash">mv mysql/user.MYD mysql/user.MYD.bak
mv mysql/user.MYI mysql/user.MYI.bak
cp test/user.MY* mysql/
chown mysql.mysql mysql/user.*
</code></pre>

<p>4、查找mysql进程号，并且发送SIGHUP信号，重新加载权限表。</p>
<pre><code>[root@localhost mysql]# pgrep -n mysql
2184
[root@localhost mysql]#
[root@localhost mysql]# kill -SIGHUP 2184
</code></pre>

<p>5、登陆测试</p>
<pre><code class="bash">[root@localhost mysql]# mysql -uroot -pyayun
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 20
Server version: 5.5.25a-log Source distribution

Copyright (c) 2000, 2011, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt;
</code></pre>

<h2 id="_1">官网参考</h2>
<ul>
<li><a href="http://dev.mysql.com/doc/refman/5.7/en/resetting-permissions.html">How to Reset the Root Password</a></li>
</ul>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
